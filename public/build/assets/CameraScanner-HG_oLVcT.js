import{r as n,a as R,j as f}from"./app-B6XYOkxb.js";/* empty css            */function M(){const o=n.useRef(null),E=n.useRef(null),v=n.useRef(null),[p,A]=n.useState(null),[x,N]=n.useState(!1),[y,I]=n.useState(!0),[j,m]=n.useState(""),c=400,i=250;return n.useEffect(()=>(navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}).then(e=>{A(e),o.current&&(o.current.srcObject=e,o.current.play())}).catch(e=>{console.error("Erreur caméra:",e),m("Erreur caméra: "+e.message)}),()=>{p?.getTracks().forEach(e=>e.stop())}),[]),n.useEffect(()=>{const e=o.current,t=v.current;if(!e||!t)return;const l=()=>{if(e.readyState===e.HAVE_ENOUGH_DATA){t.width=e.videoWidth,t.height=e.videoHeight;const r=t.getContext("2d");if(!r)return;r.clearRect(0,0,t.width,t.height);const g=(t.width-c)/2,h=(t.height-i)/2;r.fillStyle="rgba(0,0,0,0.5)",r.fillRect(0,0,t.width,t.height),r.clearRect(g,h,c,i),r.strokeStyle="#00ff00",r.lineWidth=4,r.strokeRect(g,h,c,i),r.font="20px Arial",r.fillStyle="white",r.fillText("Placez la CNI dans le cadre",g,h-10)}requestAnimationFrame(l)},b=requestAnimationFrame(l);return()=>cancelAnimationFrame(b)},[o.current]),n.useEffect(()=>{if(!o.current||!E.current||!v.current||x||!y)return;const e=setInterval(async()=>{const t=o.current,l=E.current,b=v.current;if(!t||!l||!b||t.videoWidth===0||t.videoHeight===0)return;const r=l.getContext("2d");if(!r)return;const g=t.videoWidth,h=t.videoHeight,C=(g-c)/2,D=(h-i)/2;l.width=c,l.height=i,r.drawImage(t,C,D,c,i,0,0,c,i);const S=r.getImageData(0,0,c,i),u=S.data;for(let a=0;a<u.length;a+=4){let s=u[a],w=u[a+1],T=u[a+2],d=.34*s+.5*w+.16*T;d=d>128?Math.min(255,d+40):Math.max(0,d-40),u[a]=d,u[a+1]=d,u[a+2]=d}r.putImageData(S,0,0);const H=l.toDataURL("image/jpeg",.9);m(`Capture en cours... (${new Date().toLocaleTimeString()})`),R.post("/scan-cni",{image:H},{preserveScroll:!0,onSuccess:a=>{const s=a.props?.data||{};s.nom||s.prenom||s.numero?(console.log("CNI détectée :",s),N(!0),I(!1),m("CNI détectée avec succès !"),p?.getTracks().forEach(w=>w.stop()),R.visit("/formulaire",{method:"get",data:{nom:s.nom||"",prenom:s.prenom||"",numero_cni:s.numero||""}})):m("Aucune CNI détectée. Ajustez le cadre.")},onError:a=>{console.error("Erreur OCR:",a),m("Erreur OCR: "+JSON.stringify(a))}})},3e3);return()=>clearInterval(e)},[x,y,p]),f.jsxs("div",{className:"relative w-full max-w-3xl mx-auto",children:[f.jsx("video",{ref:o,autoPlay:!0,playsInline:!0,className:"w-full h-auto rounded-lg"}),f.jsx("canvas",{ref:v,className:"absolute top-0 left-0 w-full h-full rounded-lg",style:{pointerEvents:"none"}}),f.jsx("canvas",{ref:E,style:{display:"none"}}),!x&&y&&f.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center",children:f.jsx("span",{className:"bg-black bg-opacity-70 text-white px-4 py-2 rounded-full text-sm",children:j||"Placez la carte dans le cadre vert..."})}),y&&!x&&f.jsx("button",{onClick:()=>{I(!1),p?.getTracks().forEach(e=>e.stop()),R.visit("/formulaire")},className:"absolute top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-700",children:"Annuler"})]})}export{M as default};
